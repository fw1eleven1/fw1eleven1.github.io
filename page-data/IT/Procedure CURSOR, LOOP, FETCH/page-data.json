{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/IT/Procedure CURSOR, LOOP, FETCH/",
    "result": {"data":{"site":{"siteMetadata":{"title":"js의 잡다한 블로그"}},"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>MySQL Procedure 에서 CURSOR 를 이용하여 반복문을 돌려보자</h3>\n<p>간단히 설명하자면</p>\n<ol>\n<li>쿼리문에 의해 반환된 결과값을 CURSOR에 저장한 뒤,</li>\n<li>LOOP를 돌면서 CURSOR에 저장된 결과값을 FETCH로 하나씩 꺼내서</li>\n<li>추가적인 쿼리를 실행한다던가, 뭔가를 한다던가</li>\n</ol>\n<p>하는 식으로 흘러가게 된다.\n<br></p>\n<p>예시를 하나 들어보자.</p>\n<p>user 테이블의 모든 데이터를 가져와서 나이를 강제로 한살 더 먹게 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DELIMITER</span> $\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">PROCEDURE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> userAgePlus<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">PROCEDURE</span> userAgePlus<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">BEGIN</span>\n\t<span class=\"token comment\">-- Procedure 내에서 사용할 변수 설정</span>\n\t<span class=\"token keyword\">DECLARE</span> done <span class=\"token keyword\">INT</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">DECLARE</span> v_id <span class=\"token keyword\">INTEGER</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">DECLARE</span> v_age <span class=\"token keyword\">INTEGER</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">-- user 테이블에서 모든 user의 id, age를 가져와서 CURSOR에 저장한다.</span>\n\t<span class=\"token keyword\">DECLARE</span> cursor_age <span class=\"token keyword\">CURSOR</span> <span class=\"token keyword\">FOR</span> <span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span> age <span class=\"token keyword\">FROM</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">-- LOOP 돌 때 다음 row가 없으면 done의 상태를 TRUE로 변경한다는 뜻</span>\n\t<span class=\"token keyword\">DECLARE</span> <span class=\"token keyword\">CONTINUE</span> <span class=\"token keyword\">HANDLER</span> <span class=\"token keyword\">FOR</span> <span class=\"token operator\">NOT</span> FOUND <span class=\"token keyword\">SET</span> done <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">-- 위에서 저장한 CURSOR OPEN</span>\n\t<span class=\"token keyword\">OPEN</span> cursor_age<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">-- LOOP 시작</span>\n\tage_loop: <span class=\"token keyword\">LOOP</span>\n\n\t\t<span class=\"token comment\">-- row 한 줄 가져와서 v_id, v_age 변수에 값 저장</span>\n\t\t<span class=\"token comment\">-- 콤마(,)로 구분하여 순서대로 넣어준다.</span>\n\t\t<span class=\"token keyword\">FETCH</span> cursor_age <span class=\"token keyword\">INTO</span> v_id<span class=\"token punctuation\">,</span> v_age<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">-- 강제로 나이 한 살 더 맥인 후</span>\n\t\t<span class=\"token keyword\">SET</span> v_age <span class=\"token operator\">=</span> v_age <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">-- UPDATE</span>\n\t\t<span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">SET</span> age <span class=\"token operator\">=</span> v_age <span class=\"token keyword\">where</span> id <span class=\"token operator\">=</span> v_id<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">-- 만약 다음 row 가 없다면? done의 상태가 TRUE가 되니까</span>\n\t\t<span class=\"token comment\">-- done 상태 검사해서 TRUE 일 때는 LOOP 빠져 나오기</span>\n\t\t<span class=\"token keyword\">IF</span> done <span class=\"token keyword\">THEN</span>\n\t\t\t<span class=\"token keyword\">LEAVE</span> age_loop<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">END</span> <span class=\"token keyword\">IF</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CLOSE</span> cursor_age<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">END</span> $\n<span class=\"token keyword\">DELIMITER</span> <span class=\"token punctuation\">;</span></code></pre></div>\n<p>생성한 Procedure 실행은 다음과 같이</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CALL</span> userAgePlus<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>전체 Procedure 리스트를 확인하고 싶다면?</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">PROCEDURE</span> <span class=\"token keyword\">STATUS</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Procedure를 삭제하려면?</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">PROCEDURE</span> userAgePlus<span class=\"token punctuation\">;</span></code></pre></div>","id":"11e3eca2-c477-506a-b30b-a65305d06ca2","frontmatter":{"title":"Procedure CURSOR, LOOP, FETCH","summary":"MySQL Procedure 에서 CURSOR 를 이용하여 반복문을 돌려보자","date":"2022-06-15","tags":["MySQL","Procedure"]}}}]}},"pageContext":{"slug":"/IT/Procedure CURSOR, LOOP, FETCH/"}},
    "staticQueryHashes": ["3495371188"]}